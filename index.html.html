
<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mentes Brillantes En Crecimiento Care Center | Un Lugar MÃ¡gico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: #4a90e2;
            --color-secondary: #f5a623;
            --color-accent: #e91e63;
            --color-text: #4a4a4a;
            --color-bg: #fdfdfd;
        }

        body {
            font-family: 'Poppins', sans-serif;
            color: var(--color-text);
            background-color: var(--color-bg);
            cursor: none;
        }
        
        h1, h2, h3 { font-family: 'Playfair Display', serif; }

        .magic-cursor, .magic-cursor-follower {
            position: fixed; top: 0; left: 0; pointer-events: none; border-radius: 50%; z-index: 9999;
            transition: transform 0.1s ease-out, opacity 0.3s ease;
            transform: translate(-50%, -50%);
        }
        .magic-cursor { width: 8px; height: 8px; background-color: var(--color-secondary); }
        .magic-cursor-follower { width: 30px; height: 30px; border: 2px solid var(--color-secondary); transition-duration: 0.3s; }
        .cursor-hover { transform: translate(-50%, -50%) scale(3); opacity: 0.7; }

        #preloader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--color-bg);
            z-index: 10000; display: flex; justify-content: center; align-items: center;
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
        }
        #preloader img { animation: pulse-logo 1.5s infinite ease-in-out; }
        @keyframes pulse-logo {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        #main-header { transition: background-color 0.4s ease, box-shadow 0.4s ease, padding 0.4s ease; }
        #main-header.scrolled {
            background-color: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding-top: 0.5rem; padding-bottom: 0.5rem;
        }
        #main-header.scrolled .nav-links a { color: var(--color-text); }
        #main-header.scrolled .nav-links a:hover { color: var(--color-primary); }
        #main-header.scrolled #menu-btn, #main-header.scrolled #admin-gear-btn { color: var(--color-text); }


        .reveal { opacity: 0; transform: translateY(30px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .reveal.visible { opacity: 1; transform: translateY(0); }

        .hero-bg {
            background-image: url('https://ltqoiavjtsqedjpurgnm.supabase.co/storage/v1/object/sign/guarderia/horizontal%20bbes.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9kYWFkN2FmMS03YWU1LTQwNjctYWRmZS1lOTJkYTkwNjYyYTMiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJndWFyZGVyaWEvaG9yaXpvbnRhbCBiYmVzLmpwZyIsImlhdCI6MTc1OTAzMjA3MywiZXhwIjoxNzkwNTY4MDczfQ.K1gRzO5bvAfOymIYzrv2RtxsQb3xp5ZlaUqHamC8h4E');
            background-size: cover; background-position: center; position: relative; overflow: hidden;
        }
        .hero-bg.night-mode { filter: brightness(0.6); }
        #night-sky-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        .hero-content { position: relative; z-index: 2; }
        .animated-heading { animation: subtle-glow 4s ease-in-out infinite; }
        @keyframes subtle-glow {
            0%, 100% { text-shadow: 0 0 8px rgba(255, 255, 255, 0.7); }
            50% { text-shadow: 0 0 16px rgba(255, 255, 255, 1); }
        }
        .fire-button {
            display: inline-block; background: linear-gradient(45deg, #ff7e5f, #feb47b);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2); animation: fire-pulse 2.5s infinite ease-in-out;
        }
        @keyframes fire-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 10px rgba(255, 126, 95, 0.5), 0 0 20px rgba(254, 180, 123, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(255, 126, 95, 0.8), 0 0 35px rgba(254, 180, 123, 0.5); }
        }
        
        #blurred-content-wrapper {
            position: relative;
            z-index: 1;
        }
        
        #blurred-content-wrapper::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image: url('https://ltqoiavjtsqedjpurgnm.supabase.co/storage/v1/object/public/video/imagen_2025-10-02_004355004.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            z-index: -1;
            filter: blur(5px) brightness(0.9);
        }

        .content-blur {
            background-color: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        #cuento-magico { background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8)); }

        .story-form input, .story-form select {
            background-color: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        .story-form input:focus, .story-form select:focus {
            background-color: rgba(255, 255, 255, 0.2); border-color: var(--color-secondary);
            box-shadow: 0 0 0 3px rgba(245, 166, 35, 0.5);
        }
        #historia-generada { background: rgba(0,0,0,0.2); backdrop-filter: blur(10px); line-height: 1.8; }
        .loader {
            width: 48px; height: 48px; border: 5px solid #FFF; border-bottom-color: var(--color-secondary);
            border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #creation-canvas {
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='p' width='100' height='100' patternUnits='userSpaceOnUse'%3E%3Ccircle cx='50' cy='50' r='2' fill='%23dce4ec'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23p)'/%3E%3C/svg%3E");
            min-height: 450px;
            border-radius: 1rem;
            border: 2px dashed #cbd5e1;
            position: relative;
            overflow: hidden;
            touch-action: none;
        }
        .palette-container {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            padding: 1rem;
        }
        .palette-tabs {
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 1rem;
        }
        .palette-tab {
            padding: 0.5rem 1rem;
            cursor: pointer;
            color: #64748b;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        .palette-tab.active, .palette-tab:hover {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }
        .palette-content {
            display: none;
            height: 250px;
            overflow-y: auto;
            padding-right: 10px;
        }
        .palette-content.active {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 1rem;
        }
        .palette-content svg {
            cursor: grab;
            transition: transform 0.2s ease-in-out;
            width: 100%;
            height: auto;
        }
        .palette-content svg:hover {
            transform: scale(1.15);
            filter: drop-shadow(0 4px 3px rgba(0,0,0,0.1));
        }
        .draggable-part {
            position: absolute;
            cursor: move;
            width: auto;
            height: auto;
        }
        
        .modal {
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s ease;
        }

        .admin-modal {
            background-color: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        .admin-panel-content {
             background-color: rgba(31, 41, 55, 0.9);
        }
    </style>
</head>
<body class="bg-gray-50">
    
    <div class="magic-cursor"></div>
    <div class="magic-cursor-follower"></div>

    <div id="preloader">
        <img src="https://ltqoiavjtsqedjpurgnm.supabase.co/storage/v1/object/public/video/imagen_2025-10-02_000156289.png" alt="Cargando..." class="h-24">
    </div>

    <header id="main-header" class="fixed top-0 left-0 w-full z-50 py-6 text-white">
        <nav class="container mx-auto px-6 flex justify-between items-center">
            <div>
                <a href="#"><img src="https://ltqoiavjtsqedjpurgnm.supabase.co/storage/v1/object/public/video/imagen_2025-10-02_000156289.png" alt="Logo de Mentes Brillantes" class="h-14 transition-transform duration-300 hover:scale-110"></a>
            </div>
            <div class="hidden md:flex space-x-8 nav-links text-white">
                <a href="#servicios" class="hover:text-yellow-300 transition-colors duration-300">Programas</a>
                <a href="#anuncios" class="hover:text-yellow-300 transition-colors duration-300">Anuncios</a>
                <a href="#magic-friend-lab" class="hover:text-yellow-300 transition-colors duration-300">Crea un Amigo</a>
                <a href="#cuento-magico" class="hover:text-yellow-300 transition-colors duration-300">Crea un Cuento</a>
                <a href="#instalaciones" class="hover:text-yellow-300 transition-colors duration-300">Instalaciones</a>
                <a href="#equipo" class="hover:text-yellow-300 transition-colors duration-300">Equipo</a>
                <a href="#contacto" class="hover:text-yellow-300 transition-colors duration-300">Contacto</a>
            </div>
            <div class="flex items-center space-x-4">
                <button id="admin-gear-btn" class="focus:outline-none text-white transition-transform duration-300 hover:rotate-90">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0L8.21 5.15c-.9.22-1.75.56-2.5.99L3.99 5.34c-1.28-.74-2.83.18-2.83 1.69l-.01.01 1.2 1.9c.44.7.44 1.63 0 2.33l-1.2 1.9c0 1.51 1.55 2.43 2.83 1.69l1.72-.99c.75.43 1.6.77 2.5.99l.3 1.98c.38 1.56 2.6 1.56 2.98 0l.3-1.98c.9-.22 1.75-.56 2.5-.99l1.72.99c1.28.74 2.83-.18 2.83-1.69l.01-.01-1.2-1.9c-.44-.7-.44-1.63 0-2.33l1.2-1.9c0-1.51-1.55-2.43-2.83-1.69L14.3 6.14c-.75-.43-1.6-.77-2.5-.99l-.3-1.98zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path></svg>
                </button>
                <div class="md:hidden">
                    <button id="menu-btn" class="focus:outline-none text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden px-6 pt-2 pb-4 space-y-2 bg-white text-gray-800">
             <a href="#servicios" class="block">Programas</a>
             <a href="#anuncios" class="block">Anuncios</a>
             <a href="#magic-friend-lab" class="block">Crea un Amigo</a>
             <a href="#cuento-magico" class="block">Crea un Cuento</a>
             <a href="#instalaciones" class="block">Instalaciones</a>
             <a href="#equipo" class="block">Equipo</a>
             <a href="#contacto" class="block">Contacto</a>
        </div>
    </header>

    <main>
        <section id="hero-section" class="hero-bg text-white">
            <canvas id="night-sky-canvas"></canvas>
            <div class="hero-content bg-black bg-opacity-50 min-h-screen flex items-center">
                <div class="container mx-auto px-6 py-32 text-center">
                    <h1 class="text-4xl md:text-7xl font-bold leading-tight mb-4 animated-heading">Un lugar mÃ¡gico para crecer y aprender</h1>
                    <p class="text-lg md:text-xl mb-8 font-light">En Mentes Brillantes, cada dÃ­a es una nueva aventura hacia el conocimiento.</p>
                    <a href="#contacto" class="text-white font-bold py-4 px-10 rounded-full transition duration-300 fire-button text-lg">Inscribe a tu hijo hoy</a>
                    <div class="mt-8 flex justify-center items-center space-x-6">
                         <a href="https://www.facebook.com/profile.php?id=100057441519431" target="_blank" rel="noopener noreferrer" class="transform hover:scale-110 transition-transform duration-300">
                            <img src="https://ltqoiavjtsqedjpurgnm.supabase.co/storage/v1/object/public/video/imagen_2025-10-02_001416479.png" alt="Facebook" class="h-10">
                         </a>
                         <a href="https://www.instagram.com/mentesbrillantescc" target="_blank" rel="noopener noreferrer" class="transform hover:scale-110 transition-transform duration-300">
                            <img src="https://ltqoiavjtsqedjpurgnm.supabase.co/storage/v1/object/public/video/imagen_2025-10-02_001339082.png" alt="Instagram" class="h-10">
                         </a>
                         <a href="mailto:mentesbrillantesdcc@gmail.com" class="text-white hover:text-yellow-300 transform hover:scale-110 transition-transform duration-300">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6zm-2 0l-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z"></path></svg>
                         </a>
                    </div>
                </div>
            </div>
        </section>

        <div id="blurred-content-wrapper">
            <section id="servicios" class="py-24 content-blur reveal">
                <div class="container mx-auto px-6">
                    <h2 class="text-4xl font-bold text-center text-gray-800 mb-12">Nuestros Programas</h2>
                    
                    <h3 class="text-3xl font-bold text-gray-700 mb-8 text-center">Niveles Educativos</h3>
                    <div id="niveles-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
                        <p class="text-gray-500 col-span-full text-center">Cargando niveles...</p>
                    </div>
                    
                    <h3 class="text-3xl font-bold text-gray-700 mb-8 text-center">Talleres Especiales</h3>
                    <div id="talleres-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                         <p class="text-gray-500 col-span-full text-center">Cargando talleres...</p>
                    </div>
                </div>
            </section>

            <section id="anuncios" class="py-24 content-blur reveal">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-4xl font-bold text-gray-800 mb-8">Anuncios Importantes</h2>
                    <div id="announcements-container" class="max-w-4xl mx-auto bg-white rounded-lg shadow-xl overflow-hidden">
                        <p class="p-8 text-gray-500">Cargando anuncios...</p>
                    </div>
                </div>
            </section>
            
            <section id="magic-friend-lab" class="py-24 content-blur reveal">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-12">
                        <h2 class="text-4xl font-bold text-gray-800 mb-4">Laboratorio de Amigos MÃ¡gicos</h2>
                        <p class="text-gray-600 max-w-2xl mx-auto text-lg">Â¡Es hora de crear! Haz clic en una parte para aÃ±adirla, luego arrÃ¡strala donde quieras. Â¡Haz doble clic para borrarla!</p>
                    </div>
                    <div class="lg:flex gap-8">
                        <div class="lg:w-2/3 mb-8 lg:mb-0">
                             <div id="creation-canvas" class="w-full h-full shadow-inner"></div>
                        </div>
                        <div class="lg:w-1/3">
                            <div class="palette-container">
                                <div class="flex palette-tabs">
                                    <button class="palette-tab active" data-tab="bodies">Cuerpos</button>
                                    <button class="palette-tab" data-tab="eyes">Ojos</button>
                                    <button class="palette-tab" data-tab="mouths">Bocas</button>
                                    <button class="palette-tab" data-tab="accessories">Accesorios</button>
                                </div>
                                <div id="tab-bodies" class="palette-content active">
                                    <svg data-part="body" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="#82d3f5"/></svg>
                                    <svg data-part="body" viewBox="0 0 100 100"><rect x="10" y="10" width="80" height="80" rx="20" fill="#f7c56b"/></svg>
                                    <svg data-part="body" viewBox="0 0 100 100"><path d="M50 10 L90 90 L10 90 Z" fill="#a2e5b1"/></svg>
                                    <svg data-part="body" viewBox="0 0 100 100"><ellipse cx="50" cy="50" rx="45" ry="30" fill="#f8a2b2"/></svg>
                                    <svg data-part="body" viewBox="0 0 100 100"><path d="M50 10 C 10 20, 10 80, 50 90 C 90 80, 90 20, 50 10 Z" fill="#d8b4fe"/></svg>
                                    <svg data-part="body" viewBox="0 0 100 100"><path d="M50 2 L61 38 L98 38 L68 57 L79 96 L50 75 L21 96 L32 57 L2 38 L39 38 Z" fill="#fef08a"/></svg>
                                </div>
                                <div id="tab-eyes" class="palette-content">
                                    <svg data-part="eye" viewBox="0 0 50 25"><circle cx="12.5" cy="12.5" r="10" fill="white" stroke="black" stroke-width="1"/><circle cx="12.5" cy="12.5" r="5" fill="black"/><circle cx="37.5" cy="12.5" r="10" fill="white" stroke="black" stroke-width="1"/><circle cx="37.5" cy="12.5" r="5" fill="black"/></svg>
                                    <svg data-part="eye" viewBox="0 0 25 25"><circle cx="12.5" cy="12.5" r="10" fill="white" stroke="black" stroke-width="1"/><circle cx="12.5" cy="12.5" r="5" fill="black"/><path d="M5 5 L20 20" stroke="black" stroke-width="2"/><path d="M20 5 L5 20" stroke="black" stroke-width="2"/></svg>
                                    <svg data-part="eye" viewBox="0 0 50 25"><path d="M5 20 C 15 5, 35 5, 45 20" stroke="black" stroke-width="3" fill="none"/></svg>
                                    <svg data-part="eye" viewBox="0 0 50 25"><path d="M5 10 C 15 20, 35 20, 45 10" stroke="black" stroke-width="3" fill="none"/></svg>
                                    <svg data-part="eye" viewBox="0 0 50 50"><circle cx="25" cy="25" r="20" fill="white" stroke="black" stroke-width="2"/><circle cx="25" cy="25" r="10" fill="black"/></svg>
                                    <svg data-part="eye" viewBox="0 0 80 40"><path d="M20 15 C 10 15, 5 25, 20 35 C 35 25, 30 15, 20 15 Z" fill="#ff5252"/><path d="M60 15 C 50 15, 45 25, 60 35 C 75 25, 70 15, 60 15 Z" fill="#ff5252"/></svg>
                                    <svg data-part="eye" viewBox="0 0 80 25"><path d="M5 15 Q 20 5 35 15" stroke="black" stroke-width="3" fill="none"/><path d="M45 15 Q 60 5 75 15" stroke="black" stroke-width="3" fill="none"/></svg>
                                </div>
                                <div id="tab-mouths" class="palette-content">
                                    <svg data-part="mouth" viewBox="0 0 40 20"><path d="M5 5 Q 20 20 35 5" stroke="black" stroke-width="3" fill="none"/></svg>
                                    <svg data-part="mouth" viewBox="0 0 40 20"><path d="M5 15 Q 20 0 35 15" stroke="black" stroke-width="3" fill="none"/></svg>
                                    <svg data-part="mouth" viewBox="0 0 40 20"><line x1="5" y1="10" x2="35" y2="10" stroke="black" stroke-width="3" stroke-linecap="round"/></svg>
                                    <svg data-part="mouth" viewBox="0 0 50 30"><ellipse cx="25" cy="15" rx="15" ry="10" fill="black"/></svg>
                                    <svg data-part="mouth" viewBox="0 0 50 30"><path d="M5 20 L 15 10 L 25 20 L 35 10 L 45 20" stroke="black" stroke-width="3" fill="none"/></svg>
                                    <svg data-part="mouth" viewBox="0 0 50 25"><path d="M5 5 Q 25 25 45 5" stroke="black" stroke-width="3" fill="none"/><rect x="10" y="5" width="30" height="5" fill="white"/><line x1="15" y1="5" x2="15" y2="10" stroke="black" stroke-width="2"/><line x1="25" y1="5" x2="25" y2="10" stroke="black" stroke-width="2"/><line x1="35" y1="5" x2="35" y2="10" stroke="black" stroke-width="2"/></svg>
                                </div>
                                <div id="tab-accessories" class="palette-content">
                                    <svg data-part="accessory" viewBox="0 0 100 100"><path d="M20 60 C 20 30, 80 30, 80 60 L 90 60 A 40 40 0 0 1 10 60 Z" fill="#333"/><rect x="10" y="55" width="80" height="10" fill="#555"/></svg>
                                    <svg data-part="accessory" viewBox="0 0 100 100"><path d="M10 80 L20 40 L40 60 L50 30 L60 60 L80 40 L90 80 L10 80 Z" fill="gold" stroke="#e65100" stroke-width="2"/></svg>
                                    <svg data-part="accessory" viewBox="0 0 80 50"><circle cx="20" cy="25" r="15" stroke="black" stroke-width="3" fill="none"/><circle cx="60" cy="25" r="15" stroke="black" stroke-width="3" fill="none"/><line x1="35" y1="25" x2="45" y2="25" stroke="black" stroke-width="3"/></svg>
                                    <svg data-part="accessory" viewBox="0 0 100 80"><path d="M30 80 Q 20 40 40 30" stroke="black" stroke-width="3" fill="none"/><circle cx="40" cy="30" r="5" fill="red"/><path d="M70 80 Q 80 40 60 30" stroke="black" stroke-width="3" fill="none"/><circle cx="60" cy="30" r="5" fill="red"/></svg>
                                    <svg data-part="accessory" viewBox="0 0 100 100"><path d="M50 10 L60 40 L90 40 L65 60 L75 90 L50 70 L25 90 L35 60 L10 40 L40 40 Z" fill="#ff5252"/></svg>
                                    <svg data-part="accessory" viewBox="0 0 100 100"><path d="M50 10 C 70 10, 80 30, 80 50 S 70 90, 50 90 S 20 70, 20 50 S 30 10, 50 10" fill="none" stroke="#4caf50" stroke-width="5" stroke-linecap="round"/></svg>
                                </div>
                            </div>
                            <div class="mt-6 flex flex-col gap-3">
                                <button id="reset-creation-btn" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full transition duration-300">Limpiar</button>
                                <button id="download-creation-btn" class="w-full bg-primary hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full transition duration-300">Descargar Amigo</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="cuento-magico" class="py-24 text-white reveal">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-4xl font-bold mb-4">RincÃ³n de Cuentos Encantados</h2>
                    <p class="mb-12 max-w-2xl mx-auto text-lg text-gray-200">Crea una historia mÃ¡gica y personalizada para tu pequeÃ±o. Â¡La aventura espera!</p>
                    <form id="story-generator-form" class="story-form max-w-3xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <input type="text" id="story-name" placeholder="Nombre del niÃ±o/a" class="w-full p-3 rounded-lg text-white placeholder-gray-300" required>
                        <input type="text" id="story-animal" placeholder="Su animal favorito (ej. leÃ³n, conejo)" class="w-full p-3 rounded-lg text-white placeholder-gray-300" required>
                        <input type="text" id="story-place" placeholder="Un lugar mÃ¡gico (ej. bosque encantado)" class="w-full p-3 rounded-lg text-white placeholder-gray-300" required>
                        <select id="story-trait" class="w-full p-3 rounded-lg text-white" required>
                            <option value="la valentÃ­a">EnseÃ±arle sobre la valentÃ­a</option>
                            <option value="la amabilidad">EnseÃ±arle sobre la amabilidad</option>
                            <option value="la curiosidad">EnseÃ±arle sobre la curiosidad</option>
                            <option value="la perseverancia">EnseÃ±arle sobre la perseverancia</option>
                        </select>
                        <button type="submit" class="md:col-span-2 w-full bg-secondary hover:bg-yellow-500 text-white font-bold py-3 px-8 rounded-full transition duration-300 text-lg">
                            â¨ Crear Historia MÃ¡gica
                        </button>
                    </form>
                    <div id="story-loading" class="hidden my-8">
                        <div class="loader mx-auto"></div>
                        <p class="mt-4 text-gray-200">Nuestros duendes estÃ¡n escribiendo...</p>
                    </div>
                    <div id="story-result-container" class="hidden">
                        <div id="historia-generada" class="text-left p-8 rounded-lg text-gray-100 max-w-4xl mx-auto text-lg"></div>
                        <button id="listen-story-btn" class="mt-8 bg-accent hover:bg-pink-700 text-white font-bold py-3 px-8 rounded-full transition duration-300">
                            ð§ Escuchar el Cuento
                        </button>
                    </div>
                </div>
            </section>

            <section id="instalaciones" class="py-24 content-blur reveal">
                <div class="container mx-auto px-6">
                    <h2 class="text-4xl font-bold text-center text-gray-800 mb-12">Fotos de Nuestras Instalaciones</h2>
                    <div id="gallery-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                       <p class="p-8 text-gray-500">Cargando fotos...</p>
                    </div>
                </div>
            </section>

            <section id="equipo" class="py-24 content-blur reveal">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-4xl font-bold text-gray-800 mb-12">Conoce a Nuestro Equipo</h2>
                    <div id="staff-container" class="flex flex-wrap justify-center gap-8">
                        <p class="p-8 text-gray-500">Cargando informaciÃ³n del equipo...</p>
                    </div>
                </div>
            </section>

            <section id="contacto" class="py-24 content-blur reveal">
                <div class="container mx-auto px-6">
                     <div class="lg:flex">
                         <div class="lg:w-1/2 mb-12 lg:mb-0">
                             <h2 class="text-4xl font-bold text-gray-800 mb-4">ContÃ¡ctanos</h2>
                             <p class="text-gray-600 mb-8 text-lg">Â¿Tienes preguntas o quieres agendar una visita? Â¡Nos encantarÃ­a saber de ti!</p>
                             <div class="space-y-4">
                                 <p class="flex items-center text-gray-700"><svg class="w-6 h-6 mr-3 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> A mano izquierda, 300 mts al oeste, Del taller huertas, Heredia, Puerto Viejo, 41002</p>
                                 <p class="flex items-center text-gray-700"><svg class="w-6 h-6 mr-3 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg> +506 6122-1858</p>
                                 <p class="flex items-center text-gray-700"><svg class="w-6 h-6 mr-3 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg> mentesbrillantesdcc@gmail.com</p>
                             </div>
                         </div>
                         <div class="lg:w-1/2">
                             <form id="contactForm" class="bg-white p-8 rounded-lg shadow-lg">
                                 <div class="mb-4"><label for="name" class="block text-gray-700 font-bold mb-2">Tu Nombre</label><input type="text" id="name" name="name" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required></div>
                                 <div class="mb-4"><label for="message" class="block text-gray-700 font-bold mb-2">Mensaje</label><textarea id="message" name="message" rows="4" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required></textarea></div>
                                 <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center"><svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.59 15.36 3.45 16.86L2.05 22L7.31 20.6C8.75 21.39 10.37 21.82 12.04 21.82C17.5 21.82 21.95 17.37 21.95 11.91C21.95 9.27 20.92 6.78 19.05 4.91C17.18 3.03 14.69 2 12.04 2ZM12.04 3.67C14.25 3.67 16.31 4.53 17.87 6.09C19.42 7.65 20.28 9.71 20.28 11.91C20.28 16.47 16.65 20.1 12.04 20.1C10.56 20.1 9.14 19.71 7.89 19L7.5 18.78L4.81 19.5L5.53 16.87L5.32 16.48C4.63 15.19 4.29 13.57 4.29 11.91C4.29 7.35 7.92 3.67 12.04 3.67ZM9.17 7.42C8.95 7.42 8.76 7.45 8.59 7.79C8.42 8.13 7.82 8.73 7.82 9.83C7.82 10.93 8.61 11.99 8.73 12.14C8.85 12.29 10.13 14.38 12.18 15.18C13.89 15.86 14.22 15.74 14.62 15.7C15.02 15.66 16.03 15.11 16.23 14.51C16.43 13.91 16.43 13.41 16.35 13.29C16.27 13.17 16.12 13.11 15.88 12.99C15.64 12.87 14.63 12.37 14.41 12.29C14.19 12.21 14.04 12.17 13.89 12.41C13.74 12.65 13.29 13.19 13.17 13.34C13.05 13.49 12.93 13.51 12.69 13.39C12.45 13.27 11.75 13.03 10.92 12.28C10.26 11.69 9.81 10.96 9.66 10.72C9.51 10.48 9.63 10.36 9.75 10.24C9.86 10.12 9.99 9.95 10.11 9.8C10.23 9.65 10.27 9.56 10.35 9.4C10.43 9.24 10.39 9.12 10.33 9.02C10.27 8.92 9.77 7.67 9.55 7.47C9.33 7.27 9.17 7.28 9.17 7.42Z"></path></svg> Enviar por WhatsApp</button>
                             </form>
                         </div>
                     </div>
                </div>
            </section>
        </div>
    </main>

    <div id="lightbox" class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-80 flex justify-center items-center z-[100] hidden">
        <div class="relative bg-white p-4 rounded-lg shadow-xl max-w-4xl max-h-screen">
            <img id="lightbox-img" src="" alt="Vista ampliada de la imagen" class="max-w-full max-h-[85vh] object-contain">
            <button id="close-lightbox" class="absolute -top-4 -right-4 text-white bg-gray-800 rounded-full p-2 hover:bg-gray-600 focus:outline-none transition-transform transform hover:scale-110"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
        </div>
    </div>

    <div id="level-details-modal" class="fixed inset-0 z-[101] hidden items-center justify-center p-4 modal">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h2 id="level-modal-title" class="text-2xl font-bold"></h2>
                <button id="close-level-modal" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <p id="level-modal-description" class="text-gray-600 mb-6"></p>
                <h3 class="text-xl font-bold mb-4">GalerÃ­a de la Clase</h3>
                <div id="level-modal-gallery" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <p>Cargando galerÃ­a...</p>
                </div>
            </div>
        </div>
    </div>

    <div id="admin-login-modal" class="fixed inset-0 z-[102] hidden items-center justify-center admin-modal">
        <div class="bg-white rounded-lg p-8 shadow-2xl w-full max-w-sm">
            <h2 class="text-2xl font-bold text-center mb-6">Acceso de Administrador</h2>
            <form id="admin-login-form">
                <input type="password" id="admin-password" placeholder="ContraseÃ±a" class="w-full p-3 border rounded-lg mb-4" required>
                <button type="submit" class="w-full bg-primary text-white p-3 rounded-lg font-bold hover:bg-blue-700">Ingresar</button>
                <p id="login-error" class="text-red-500 text-center mt-2 hidden">ContraseÃ±a incorrecta.</p>
            </form>
        </div>
    </div>
    
    <div id="photo-manager-modal" class="fixed inset-0 z-[103] hidden items-center justify-center p-4 admin-modal">
        <div class="bg-gray-800 text-white rounded-lg shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b border-gray-700">
                <h2 id="photo-manager-title" class="text-2xl font-bold">Gestionar Fotos</h2>
                <button id="close-photo-manager" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <form id="add-photo-form" class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                    <input type="url" id="photo-url" placeholder="URL de la nueva foto" class="p-2 border rounded-lg bg-gray-700 border-gray-600 md:col-span-2" required>
                    <button type="submit" class="bg-green-500 text-white p-2 rounded-lg font-bold hover:bg-green-600">Agregar Foto</button>
                </form>
                <div id="photo-manager-gallery" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <p>Cargando fotos...</p>
                </div>
            </div>
        </div>
    </div>


    <div id="admin-panel" class="fixed inset-0 z-[101] hidden bg-gray-100 p-8 overflow-y-auto">
        <div class="container mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-4xl font-bold">Panel de AdministraciÃ³n</h1>
                <button id="logout-btn" class="bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600">Cerrar SesiÃ³n</button>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-lg mt-8">
                <h2 class="text-2xl font-bold mb-4">Gestionar Niveles Educativos</h2>
                <form id="add-nivel-form" class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="nivel-title" placeholder="TÃ­tulo (ej. Materno 1)" class="p-2 border rounded-lg" required>
                    <input type="url" id="nivel-photo-url" placeholder="URL de la foto de portada" class="p-2 border rounded-lg" required>
                    <textarea id="nivel-description" placeholder="DescripciÃ³n corta" class="p-2 border rounded-lg md:col-span-2" rows="3" required></textarea>
                    <button type="submit" class="bg-green-500 text-white p-2 rounded-lg font-bold hover:bg-green-600 md:col-span-2">Agregar Nivel</button>
                </form>
                <div id="admin-niveles-list" class="space-y-4"></div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-lg mt-8">
                <h2 class="text-2xl font-bold mb-4">Gestionar Talleres</h2>
                <form id="add-taller-form" class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="taller-title" placeholder="Nombre del Taller" class="p-2 border rounded-lg" required>
                    <input type="url" id="taller-photo-url" placeholder="URL de la foto de portada" class="p-2 border rounded-lg" required>
                    <textarea id="taller-description" placeholder="DescripciÃ³n corta" class="p-2 border rounded-lg md:col-span-2" rows="3" required></textarea>
                    <button type="submit" class="bg-green-500 text-white p-2 rounded-lg font-bold hover:bg-green-600 md:col-span-2">Agregar Taller</button>
                </form>
                <div id="admin-talleres-list" class="space-y-4"></div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-lg mt-8">
                <h2 class="text-2xl font-bold mb-4">Gestionar Anuncios</h2>
                <form id="add-announcement-form" class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                    <input type="url" id="announcement-url" placeholder="URL de la imagen del anuncio" class="p-2 border rounded-lg md:col-span-2" required>
                    <button type="submit" class="bg-green-500 text-white p-2 rounded-lg font-bold hover:bg-green-600">Agregar Anuncio</button>
                </form>
                <div id="admin-announcements-list"></div>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-lg mt-8">
                 <h2 class="text-2xl font-bold mb-4">Gestionar Fotos de Instalaciones</h2>
                 <form id="add-gallery-form" class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                     <input type="url" id="gallery-url" placeholder="URL de la nueva foto" class="p-2 border rounded-lg md:col-span-2" required>
                     <button type="submit" class="bg-green-500 text-white p-2 rounded-lg font-bold hover:bg-green-600">Agregar Foto</button>
                </form>
                <div id="admin-gallery-list" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-lg mt-8">
                 <h2 class="text-2xl font-bold mb-4">Gestionar Equipo de Profesores</h2>
                 <form id="add-staff-form" class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                     <input type="text" id="staff-name" placeholder="Nombre completo" class="p-2 border rounded-lg" required>
                     <input type="text" id="staff-role" placeholder="Estudios / Especialidad" class="p-2 border rounded-lg" required>
                     <input type="number" id="staff-experience" placeholder="AÃ±os de experiencia" class="p-2 border rounded-lg" required>
                     <input type="url" id="staff-photo-url" placeholder="URL de la foto" class="p-2 border rounded-lg" required>
                     <button type="submit" class="bg-green-500 text-white p-2 rounded-lg font-bold hover:bg-green-600 md:col-span-2">Agregar Profesor</button>
                </form>
                <div id="admin-staff-list" class="space-y-4"></div>
            </div>
        </div>
    </div>


    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-6 text-center">
            
            <p>&copy; 2025 Mentes Brillantes En Crecimiento Care Center. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, addDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- CONFIGURACIÃN DE FIREBASE ---
        const firebaseConfig = {};
        let app, db, auth;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let currentEditingLevelId = null;

        async function initializeFirebase() {
            try {
                const config = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : firebaseConfig;
                if (!config.apiKey) {
                    throw new Error("La configuraciÃ³n de Firebase no estÃ¡ completa.");
                }
                app = initializeApp(config);
                db = getFirestore(app);
                auth = getAuth(app);
                console.log("Firebase initialized.");
                return true;
            } catch (error) {
                console.warn("ADVERTENCIA: No se pudo inicializar Firebase. Se usarÃ¡n datos de ejemplo. Error:", error.message);
                return false;
            }
        }
        
        // --- INICIALIZACIÃN GENERAL ---
        document.addEventListener('DOMContentLoaded', async () => {
            initPreloader();
            initMagicCursor();
            initDynamicHeader();
            initScrollAnimations();
            initMobileMenu();
            initLightbox();
            initContactForm();
            initStoryGenerator();
            initMagicFriendLab();
            initAdminPanel();
            initModals();

            const firebaseReady = await initializeFirebase();

            if (firebaseReady) {
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        console.log("Usuario autenticado:", user.uid, "Cargando datos...");
                        loadRealData();
                    } else {
                        console.log("El usuario no estÃ¡ autenticado. Intentando iniciar sesiÃ³n...");
                         signIn();
                    }
                });
            } else {
                loadSampleData();
            }
        });

        async function signIn() {
            try {
                 if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                    console.log("Signed in with custom token.");
                } else {
                    await signInAnonymously(auth);
                    console.log("Signed in anonymously.");
                }
            } catch (error) {
                console.error("Fallo el inicio de sesiÃ³n. Cargando datos de ejemplo.", error);
                loadSampleData();
            }
        }

        function initModals(){
             // --- Modal de Detalles del Nivel ---
            const levelDetailsModal = document.getElementById('level-details-modal');
            const closeLevelModalBtn = document.getElementById('close-level-modal');
            
            closeLevelModalBtn.addEventListener('click', () => levelDetailsModal.classList.add('hidden'));
            levelDetailsModal.addEventListener('click', (e) => {
                if (e.target === levelDetailsModal) levelDetailsModal.classList.add('hidden');
            });

            // --- Modal del Gestor de Fotos ---
            const photoManagerModal = document.getElementById('photo-manager-modal');
            const closePhotoManagerBtn = document.getElementById('close-photo-manager');

            closePhotoManagerBtn.addEventListener('click', () => photoManagerModal.classList.add('hidden'));
             photoManagerModal.addEventListener('click', (e) => {
                if (e.target === photoManagerModal) photoManagerModal.classList.add('hidden');
            });
        }


        function initPreloader() {
            const preloader = document.getElementById('preloader');
            window.addEventListener('load', () => {
                preloader.style.opacity = '0';
                setTimeout(() => { preloader.style.display = 'none'; }, 500);
            });
        }
        
        function initMagicCursor() { 
            const cursor = document.querySelector('.magic-cursor');
            const follower = document.querySelector('.magic-cursor-follower');
            if (!cursor || !follower) return;
            
            document.addEventListener('mousemove', e => {
                follower.style.transform = `translate(${e.clientX}px, ${e.clientY}px)`;
                cursor.style.transform = `translate(${e.clientX}px, ${e.clientY}px)`;
            });
            document.querySelectorAll('a, button, .cursor-pointer, img, svg').forEach(el => {
                el.addEventListener('mouseenter', () => follower.classList.add('cursor-hover'));
                el.addEventListener('mouseleave', () => follower.classList.remove('cursor-hover'));
            });
        }
        function initDynamicHeader() { 
            const header = document.getElementById('main-header');
            if (header) {
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 50) header.classList.add('scrolled');
                    else header.classList.remove('scrolled');
                });
            }
        }
        function initScrollAnimations() { 
            const revealElements = document.querySelectorAll('.reveal');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('visible');
                });
            }, { threshold: 0.1 });
            revealElements.forEach(el => observer.observe(el));
        }
        function initMobileMenu() { 
            const menuBtn = document.getElementById('menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            if (menuBtn && mobileMenu) menuBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
        }
        
        function initContactForm() { 
             const contactForm = document.getElementById('contactForm');
            if (contactForm) {
                contactForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const name = document.getElementById('name').value;
                    const message = document.getElementById('message').value;
                    const whatsappUrl = `https://wa.me/50661221858?text=${encodeURIComponent(`Â¡Hola! Soy ${name}. QuerÃ­a consultar lo siguiente: ${message}`)}`;
                    window.open(whatsappUrl, '_blank');
                    contactForm.reset();
                });
            }
        }
        function initStoryGenerator() {
             const storyForm = document.getElementById('story-generator-form');
            const storyLoader = document.getElementById('story-loading');
            const storyResultContainer = document.getElementById('story-result-container');
            const storyTextElement = document.getElementById('historia-generada');
            const listenBtn = document.getElementById('listen-story-btn');

            async function generateContentWithGemini(prompt) {
                const apiKey = ""; // La API Key se inyectarÃ¡ en el entorno de ejecuciÃ³n
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const payload = { contents: [{ parts: [{ text: prompt }] }] };
                
                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) {
                        const errorBody = await response.text();
                        throw new Error(`Error en la API: ${response.statusText} - ${errorBody}`);
                    }
                    const data = await response.json();
                    if (!data.candidates || !data.candidates[0] || !data.candidates[0].content || !data.candidates[0].content.parts[0]) {
                         throw new Error("Respuesta inesperada de la API de Gemini.");
                    }
                    return data.candidates[0].content.parts[0].text;
                } catch(e) {
                    console.error("Fallo en la llamada a la API de Gemini:", e);
                    return "Â¡Oh no! Nuestros duendes mÃ¡gicos estÃ¡n tomando una siesta. Por favor, revisa la configuraciÃ³n de la API o intÃ©ntalo de nuevo mÃ¡s tarde.";
                }
            }

            if (storyForm) {
                storyForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    storyResultContainer.classList.add('hidden');
                    storyLoader.classList.remove('hidden');
                    window.speechSynthesis.cancel();
                    
                    const name = document.getElementById('story-name').value;
                    const animal = document.getElementById('story-animal').value;
                    const place = document.getElementById('story-place').value;
                    const trait = document.getElementById('story-trait').value;
                    const userPrompt = `Crea un cuento infantil corto y mÃ¡gico para dormir, de no mÃ¡s de 200 palabras. El protagonista se llama ${name}, es un/a ${animal} muy especial. La historia sucede en ${place}. El tono debe ser tierno, positivo y con una moraleja sutil sobre el valor de ${trait}.`;

                    const generatedStory = await generateContentWithGemini(userPrompt);
                    storyTextElement.textContent = generatedStory;
                    storyLoader.classList.add('hidden');
                    storyResultContainer.classList.remove('hidden');
                });
            }
            
            if (listenBtn) {
                listenBtn.addEventListener('click', () => {
                    const storyText = storyTextElement.textContent;
                    if (storyText && 'speechSynthesis' in window) {
                        const utterance = new SpeechSynthesisUtterance(storyText);
                        utterance.lang = 'es-ES';
                        utterance.rate = 0.9;
                        window.speechSynthesis.cancel();
                        window.speechSynthesis.speak(utterance);
                    } else {
                        console.warn('Tu navegador no soporta la narraciÃ³n de voz.');
                    }
                });
            }
        }

        function initLightbox() {
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const closeLightboxBtn = document.getElementById('close-lightbox');
            const galleryContainer = document.getElementById('gallery-container');
            if (lightbox && lightboxImg && closeLightboxBtn && galleryContainer) {
                galleryContainer.addEventListener('click', (e) => {
                    const img = e.target.closest('img');
                    if(img){
                        lightboxImg.src = img.src;
                        lightbox.classList.remove('hidden');
                    }
                });
                const closeLightbox = () => lightbox.classList.add('hidden');
                closeLightboxBtn.addEventListener('click', closeLightbox);
                lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
            }
        }
        
        function initAdminPanel() {
            const loginModal = document.getElementById('admin-login-modal');
            const adminPanel = document.getElementById('admin-panel');
            const loginBtn = document.getElementById('admin-gear-btn');
            const loginForm = document.getElementById('admin-login-form');
            const logoutBtn = document.getElementById('logout-btn');

            loginBtn.addEventListener('click', () => loginModal.style.display = 'flex');
            
            loginModal.addEventListener('click', (e) => {
                if (e.target === loginModal) loginModal.style.display = 'none';
            });
            
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const password = document.getElementById('admin-password').value;
                const errorEl = document.getElementById('login-error');
                if (password === '2000') {
                    loginModal.style.display = 'none';
                    adminPanel.style.display = 'block';
                    errorEl.classList.add('hidden');
                    loginForm.reset();
                } else {
                    errorEl.classList.remove('hidden');
                }
            });
            logoutBtn.addEventListener('click', () => adminPanel.style.display = 'none');
            
            document.getElementById('add-nivel-form').addEventListener('submit', e => {
                const form = e.target.elements;
                const data = {
                    title: form['nivel-title'].value,
                    description: form['nivel-description'].value,
                    photoUrl: form['nivel-photo-url'].value,
                };
                handleAdd(e, 'niveles', data);
            });

            document.getElementById('add-taller-form').addEventListener('submit', e => {
                const form = e.target.elements;
                const data = {
                    title: form['taller-title'].value,
                    description: form['taller-description'].value,
                    photoUrl: form['taller-photo-url'].value,
                };
                handleAdd(e, 'talleres', data);
            });

            document.getElementById('add-photo-form').addEventListener('submit', e => {
                e.preventDefault();
                if(!currentEditingLevelId) return;
                const photoUrl = document.getElementById('photo-url').value;
                const path = `niveles/${currentEditingLevelId}/photos`;
                handleAdd(e, path, { url: photoUrl });
            });


            document.getElementById('add-announcement-form').addEventListener('submit', e => handleAdd(e, 'announcements', { url: e.target.elements['announcement-url'].value }));
            document.getElementById('add-gallery-form').addEventListener('submit', e => handleAdd(e, 'gallery_photos', { url: e.target.elements['gallery-url'].value }));
            document.getElementById('add-staff-form').addEventListener('submit', e => {
                const form = e.target.elements;
                const data = {
                    name: form['staff-name'].value,
                    role: form['staff-role'].value,
                    experience: form['staff-experience'].value,
                    photoUrl: form['staff-photo-url'].value,
                };
                handleAdd(e, 'staff', data);
            });
        }
        
        async function handleAdd(event, collectionPath, data) {
            event.preventDefault();
            if (!db) { console.error("Base de datos no disponible."); return; }
            try {
                await addDoc(collection(db, `artifacts/${appId}/public/data/${collectionPath}`), { ...data, createdAt: serverTimestamp() });
                event.target.reset();
            } catch (error) {
                console.error(`Error al agregar documento a ${collectionPath}:`, error);
            }
        }
        
        async function handleDelete(collectionPath, docId) {
             if (!db) { console.error("Base de datos no disponible."); return; }
            try {
                await deleteDoc(doc(db, `artifacts/${appId}/public/data/${collectionPath}`, docId));
            } catch (error) {
                console.error(`Error al eliminar documento de ${collectionPath}:`, error);
            }
        }

        function loadRealData() {
            const collections = {
                niveles: {
                    container: document.getElementById('niveles-container'),
                    adminList: document.getElementById('admin-niveles-list'),
                    emptyMsg: 'Nuestros niveles educativos se agregarÃ¡n pronto.',
                    renderCard: (doc) => {
                        const data = doc.data();
                        return `
                        <div class="bg-white/80 rounded-lg shadow-lg overflow-hidden transform hover:-translate-y-2 transition-transform duration-300 cursor-pointer" data-level-id="${doc.id}" data-level-title="${data.title}" data-level-description="${data.description}">
                            <img src="${data.photoUrl}" alt="${data.title}" class="w-full h-56 object-cover pointer-events-none">
                            <div class="p-6 pointer-events-none">
                                <h4 class="text-2xl font-bold text-gray-800 mb-2">${data.title}</h4>
                                <p class="text-gray-600">${data.description}</p>
                            </div>
                        </div>`;
                    },
                    renderAdminItem: (doc) => {
                        const data = doc.data();
                        return `
                        <div class="flex justify-between items-center p-2 border-b">
                            <img src="${data.photoUrl}" class="h-10 w-16 object-cover rounded">
                            <span class="font-semibold mx-2 flex-1">${data.title}</span>
                             <button class="manage-photos-btn bg-blue-500 text-white px-2 py-1 rounded text-xs mr-2" data-level-id="${doc.id}" data-level-title="${data.title}">Fotos</button>
                            <button class="delete-btn bg-red-500 text-white px-2 py-1 rounded text-xs" data-path="niveles" data-id="${doc.id}">Eliminar</button>
                        </div>`;
                    }
                },
                talleres: {
                    container: document.getElementById('talleres-container'),
                    adminList: document.getElementById('admin-talleres-list'),
                    emptyMsg: 'Nuestros talleres especiales se agregarÃ¡n pronto.',
                    renderCard: (doc) => {
                        const data = doc.data();
                        return`
                        <div class="bg-white/80 rounded-lg shadow-lg overflow-hidden transform hover:-translate-y-2 transition-transform duration-300">
                            <img src="${data.photoUrl}" alt="${data.title}" class="w-full h-56 object-cover">
                            <div class="p-6">
                                <h4 class="text-2xl font-bold text-gray-800 mb-2">${data.title}</h4>
                                <p class="text-gray-600">${data.description}</p>
                            </div>
                        </div>`;
                    },
                     renderAdminItem: (doc) => {
                        const data = doc.data();
                        return `
                        <div class="flex justify-between items-center p-2 border-b">
                            <img src="${data.photoUrl}" class="h-10 w-16 object-cover rounded">
                             <span class="font-semibold mx-2 flex-1">${data.title}</span>
                            <button class="delete-btn bg-red-500 text-white px-2 py-1 rounded text-xs" data-path="talleres" data-id="${doc.id}">Eliminar</button>
                        </div>`;
                    }
                },
                announcements: {
                    container: document.getElementById('announcements-container'),
                    adminList: document.getElementById('admin-announcements-list'),
                    emptyMsg: 'No hay anuncios por el momento.',
                    renderCard: (doc) => {
                        const data = doc.data();
                        const date = data.createdAt?.toDate().toLocaleDateString('es-CR') || new Date().toLocaleDateString('es-CR');
                        return `
                        <img src="${data.url}" alt="Anuncio" class="w-full">
                        <div class="p-4"><p class="text-gray-500 text-sm">Publicado el ${date}</p></div>`;
                    },
                    renderAdminItem: (doc) => {
                        const data = doc.data();
                        const date = data.createdAt?.toDate().toLocaleDateString('es-CR') || '';
                        return `
                        <div class="flex justify-between items-center p-2 border-b">
                            <img src="${data.url}" class="h-10 w-16 object-cover">
                            <span>${date}</span>
                            <button class="delete-btn bg-red-500 text-white px-2 py-1 rounded text-xs" data-path="announcements" data-id="${doc.id}">Eliminar</button>
                        </div>`;
                    }
                },
                gallery_photos: {
                    container: document.getElementById('gallery-container'),
                    adminList: document.getElementById('admin-gallery-list'),
                    emptyMsg: 'No hay fotos en la galerÃ­a.',
                    renderCard: (doc) => `<div><img src="${doc.data().url}" alt="Foto de las instalaciones" class="rounded-lg shadow-md w-full h-80 object-cover transform hover:scale-105 transition-transform duration-300"></div>`,
                    renderAdminItem: (doc) => `<div class="relative"><img src="${doc.data().url}" class="h-24 w-full object-cover rounded"><button class="delete-btn absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 text-xs" data-path="gallery_photos" data-id="${doc.id}">X</button></div>`
                },
                 staff: {
                    container: document.getElementById('staff-container'),
                    adminList: document.getElementById('admin-staff-list'),
                    emptyMsg: 'La informaciÃ³n del equipo se agregarÃ¡ pronto.',
                    renderCard: (doc) => {
                        const data = doc.data();
                        return `
                        <div class="w-full sm:w-1/2 md:w-1/3 lg:w-1/4 p-4">
                            <div class="bg-white/90 p-6 rounded-lg shadow-lg text-center">
                                <img src="${data.photoUrl}" alt="Foto de ${data.name}" class="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-gray-200 object-cover">
                                <h3 class="text-xl font-bold text-gray-800">${data.name}</h3>
                                <p class="text-blue-600">${data.role}</p>
                                <p class="text-gray-500 text-sm mt-1">${data.experience} aÃ±os de experiencia</p>
                            </div>
                        </div>`;
                    },
                    renderAdminItem: (doc) => {
                        const data = doc.data();
                        return `
                        <div class="flex justify-between items-center p-2 border-b">
                            <img src="${data.photoUrl}" class="h-10 w-10 object-cover rounded-full">
                            <span class="flex-1 mx-2">${data.name} - ${data.role}</span>
                            <button class="delete-btn bg-red-500 text-white px-2 py-1 rounded text-xs" data-path="staff" data-id="${doc.id}">Eliminar</button>
                        </div>`;
                    }
                }
            };

            for (const key in collections) {
                const config = collections[key];
                onSnapshot(collection(db, `artifacts/${appId}/public/data/${key}`), (snapshot) => {
                    config.container.innerHTML = '';
                    if (config.adminList) config.adminList.innerHTML = '';

                    if(snapshot.empty) {
                        config.container.innerHTML = `<p class="p-8 text-gray-500 col-span-full text-center">${config.emptyMsg}</p>`;
                    } else {
                        snapshot.docs.forEach(doc => {
                            config.container.innerHTML += config.renderCard(doc);
                            if (config.adminList) {
                                config.adminList.innerHTML += config.renderAdminItem(doc);
                            }
                        });
                    }
                });
            }

            document.body.addEventListener('click', e => {
                const target = e.target;
                if (target.classList.contains('delete-btn')) {
                    const { path, id } = target.dataset;
                    const subpath = target.dataset.subpath || '';
                    const fullpath = subpath ? `${path}/${subpath}/photos` : path;
                    handleDelete(fullpath, id);
                }
                
                if (target.closest('[data-level-id]')) {
                    const card = target.closest('[data-level-id]');
                    const { levelId, levelTitle, levelDescription } = card.dataset;
                    openLevelModal(levelId, levelTitle, levelDescription);
                }

                if (target.classList.contains('manage-photos-btn')) {
                    const { levelId, levelTitle } = target.dataset;
                    openPhotoManager(levelId, levelTitle);
                }
            });
        }
        
        function openLevelModal(levelId, title, description) {
            const modal = document.getElementById('level-details-modal');
            document.getElementById('level-modal-title').textContent = title;
            document.getElementById('level-modal-description').textContent = description;
            const gallery = document.getElementById('level-modal-gallery');
            gallery.innerHTML = '<p>Cargando galerÃ­a...</p>';
            modal.classList.remove('hidden');

            const photosPath = `artifacts/${appId}/public/data/niveles/${levelId}/photos`;
            onSnapshot(collection(db, photosPath), (snapshot) => {
                gallery.innerHTML = '';
                if(snapshot.empty) {
                    gallery.innerHTML = '<p class="text-gray-500 col-span-full">No hay fotos en esta galerÃ­a todavÃ­a.</p>';
                } else {
                    snapshot.forEach(doc => {
                        gallery.innerHTML += `<div class="relative"><img src="${doc.data().url}" class="w-full h-40 object-cover rounded-lg"></div>`;
                    });
                }
            });
        }
        
        function openPhotoManager(levelId, title) {
            currentEditingLevelId = levelId;
            const modal = document.getElementById('photo-manager-modal');
            document.getElementById('photo-manager-title').textContent = `Fotos de: ${title}`;
            const gallery = document.getElementById('photo-manager-gallery');
            gallery.innerHTML = '<p>Cargando fotos...</p>';
            modal.classList.remove('hidden');

            const photosPath = `artifacts/${appId}/public/data/niveles/${levelId}/photos`;
            onSnapshot(collection(db, photosPath), (snapshot) => {
                gallery.innerHTML = '';
                if(snapshot.empty) {
                    gallery.innerHTML = '<p class="text-gray-400 col-span-full">No hay fotos. Â¡Agrega la primera!</p>';
                } else {
                    snapshot.forEach(doc => {
                        gallery.innerHTML += `
                        <div class="relative">
                            <img src="${doc.data().url}" class="h-24 w-full object-cover rounded">
                            <button class="delete-btn absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 text-xs" data-path="niveles" data-subpath="${levelId}" data-id="${doc.id}">X</button>
                        </div>`;
                    });
                }
            });
        }

        function loadSampleData() {
             console.log("Mostrando datos de ejemplo.");
             document.getElementById('niveles-container').innerHTML = `
                <div class="bg-white/80 rounded-lg shadow-lg overflow-hidden"><img src="https://placehold.co/600x400/a2e5b1/4a4a4a?text=Materno" alt="[Imagen de bebÃ©s jugando]" class="w-full h-56 object-cover"><div class="p-6"><h4 class="text-2xl font-bold text-gray-800">Materno</h4><p>Cuidado y estimulaciÃ³n temprana para los mÃ¡s pequeÃ±os en un ambiente seguro y amoroso.</p></div></div>
                <div class="bg-white/80 rounded-lg shadow-lg overflow-hidden"><img src="https://placehold.co/600x400/f7c56b/4a4a4a?text=TransiciÃ³n" alt="[Imagen de niÃ±os en edad preescolar aprendiendo]" class="w-full h-56 object-cover"><div class="p-6"><h4 class="text-2xl font-bold text-gray-800">TransiciÃ³n</h4><p>PreparaciÃ³n lÃºdica y educativa para la etapa escolar, fomentando la independencia.</p></div></div>
                <div class="bg-white/80 rounded-lg shadow-lg overflow-hidden"><img src="https://placehold.co/600x400/82d3f5/4a4a4a?text=Escolares" alt="[Imagen de niÃ±os mayores haciendo tareas]" class="w-full h-56 object-cover"><div class="p-6"><h4 class="text-2xl font-bold text-gray-800">Escolares</h4><p>Apoyo con tareas y actividades recreativas despuÃ©s de clases para niÃ±os en edad escolar.</p></div></div>`;
            document.getElementById('talleres-container').innerHTML = `
                <div class="bg-white/80 rounded-lg shadow-lg overflow-hidden"><img src="https://placehold.co/600x400/f8a2b2/4a4a4a?text=Artes" alt="[Imagen de niÃ±os pintando]" class="w-full h-56 object-cover"><div class="p-6"><h4 class="text-2xl font-bold text-gray-800">Taller de Artes</h4><p>ExploraciÃ³n de la creatividad a travÃ©s de la pintura, el dibujo y el modelado.</p></div></div>
                <div class="bg-white/80 rounded-lg shadow-lg overflow-hidden"><img src="https://placehold.co/600x400/d8b4fe/4a4a4a?text=InglÃ©s" alt="[Imagen de niÃ±os cantando en inglÃ©s]" class="w-full h-56 object-cover"><div class="p-6"><h4 class="text-2xl font-bold text-gray-800">Taller de InglÃ©s</h4><p>Aprendizaje del idioma inglÃ©s de forma divertida con juegos, canciones y actividades interactivas.</p></div></div>
                <div class="bg-white/80 rounded-lg shadow-lg overflow-hidden"><img src="https://placehold.co/600x400/fef08a/4a4a4a?text=Danza" alt="[Imagen de niÃ±os bailando]" class="w-full h-56 object-cover"><div class="p-6"><h4 class="text-2xl font-bold text-gray-800">Danza ContemporÃ¡nea</h4><p>Fomentamos la expresiÃ³n corporal, el ritmo y el desarrollo de la coordinaciÃ³n motriz.</p></div></div>`;
             document.getElementById('announcements-container').innerHTML = `<p class="p-8 text-gray-500">No hay anuncios por el momento (modo de ejemplo).</p>`;
             document.getElementById('gallery-container').innerHTML = `<p class="p-8 text-gray-500">No hay fotos en la galerÃ­a (modo de ejemplo).</p>`;
             document.getElementById('staff-container').innerHTML = `<p class="p-8 text-gray-500">La informaciÃ³n del equipo no estÃ¡ disponible (modo de ejemplo).</p>`;
        }
        
        function initMagicFriendLab() {
            const creationCanvas = document.getElementById('creation-canvas');
            if (!creationCanvas) return;
            const paletteTabs = document.querySelectorAll('.palette-tab');
            const paletteContents = document.querySelectorAll('.palette-content');
            const resetBtn = document.getElementById('reset-creation-btn');
            const downloadCreationBtn = document.getElementById('download-creation-btn');
            let activePart = null;
            let offset = { x: 0, y: 0 };
            const startDrag = (e, part) => {
                if (e.type === 'touchstart') e.preventDefault();
                activePart = part;
                const event = e.touches ? e.touches[0] : e;
                const rect = part.getBoundingClientRect();
                offset.x = event.clientX - rect.left;
                offset.y = event.clientY - rect.top;
                activePart.style.cursor = 'grabbing';
                activePart.style.zIndex = 1000;
            };
            const drag = e => {
                if (!activePart) return;
                e.preventDefault();
                const event = e.touches ? e.touches[0] : e;
                const canvasRect = creationCanvas.getBoundingClientRect();
                let x = event.clientX - canvasRect.left - offset.x;
                let y = event.clientY - canvasRect.top - offset.y;
                x = Math.max(0, Math.min(x, canvasRect.width - activePart.getBoundingClientRect().width));
                y = Math.max(0, Math.min(y, canvasRect.height - activePart.getBoundingClientRect().height));
                activePart.style.left = `${x}px`;
                activePart.style.top = `${y}px`;
            };
            const endDrag = () => {
                if(activePart) {
                    activePart.style.cursor = 'move';
                    activePart.style.zIndex = '';
                }
                activePart = null;
            };
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
            const addPartToCanvas = (svgElement) => {
                const newPart = svgElement.cloneNode(true);
                newPart.classList.add('draggable-part');
                const viewBox = newPart.getAttribute('viewBox');
                if (viewBox) {
                    const dims = viewBox.split(' ');
                    newPart.style.width = `${dims[2]}px`;
                    newPart.style.height = `${dims[3]}px`;
                }
                creationCanvas.appendChild(newPart);
                const partRect = newPart.getBoundingClientRect();
                newPart.style.left = `${(creationCanvas.clientWidth / 2) - (partRect.width / 2)}px`;
                newPart.style.top = `${(creationCanvas.clientHeight / 2) - (partRect.height / 2)}px`;
                newPart.addEventListener('mousedown', e => startDrag(e, newPart));
                newPart.addEventListener('touchstart', e => startDrag(e, newPart));
                newPart.addEventListener('dblclick', () => newPart.remove());
            };
            paletteTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    paletteTabs.forEach(t => t.classList.remove('active'));
                    paletteContents.forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`tab-${tab.dataset.tab}`).classList.add('active');
                });
            });
            document.querySelectorAll('.palette-content svg').forEach(partSVG => {
                partSVG.addEventListener('click', () => addPartToCanvas(partSVG));
            });
            if(resetBtn) resetBtn.addEventListener('click', () => { creationCanvas.innerHTML = ''; });

            if(downloadCreationBtn) {
                downloadCreationBtn.addEventListener('click', () => {
                    html2canvas(creationCanvas, {
                        backgroundColor: null,
                    }).then(canvas => {
                        const link = document.createElement('a');
                        link.download = 'mi-amigo-magico.png';
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    });
                });
            }
        }
    </script>
</body>
</html>

